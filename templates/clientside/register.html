{% extends 'clientside/clientBase.html' %}
{% block title %}
<title>Register - Acupuncture and Herbal Medicine with Dr. Lee</title>
{% endblock %}
{% block linkcontent %}
<link rel="stylesheet" href="{{url_for('static', path='/assets/css/register.css')}}" type="text/css">	
{% endblock %}
{% block content %}
<br><br><br><br>
<section>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
      <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
    </symbol>
    <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
      <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
    </symbol>
    <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
      <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
    </symbol>
  </svg>
  
   <div class="card" style="border-top-right-radius: 50%">
     <div class="container">
       <div class="col-md-12 mb-4">
         <h2 class="h4"></h2>
         <br>
         <br>
         <br>
         <div class="container">
           <div class="card" style="border-radius: 00rem 0 0 0rem; z-index:10">
             <form action="https://fth-clinic.herokuapp.com/users/register" method="POST" class="form" id="registerForm">
               <h4 class="text-center">Registration Form</h4>
               <!-- Progress bar -->
               <center>
                 <div class="progressbar">
                   <div class="progress" id="progress"></div>
                   <div class="progress-step progress-step-active" data-title="User&nbsp;ID"></div>
                   <div class="progress-step" data-title="Contact&nbsp;Information"></div>
                 </div>
                 <br>
                 <!-- Steps -->
                 <div id="failedRegister"></div>
                 <div class="form-step form-step-active">
                   <div class="input-group">
                     <label for="userID">
                       <span class="o-label">Email or Username</span>
                     </label>
                     <input required type="text" id="username" name="user_username" required="active" placeholder="Email or Username" />
                   </div>
                   <div class="input-group">
                     <label for="password">
                       <span class="o-label">Password</span>
                     </label>
                     <input required type="password" id="password" name="user_password" required="active" placeholder="Password" />
                   </div>
                   <div class="">
                     <a href="#" class="btn btn-next width-50 ml-auto">Next</a>
                   </div>
                 </div>
               </center>
               <div class="form-step">
                 <div class="input-group">
                   <div class="row">
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">First Name</span>
                         <input type="text" class="form-control" name="cl_firstName" required="active" placeholder="First Name">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label"> Marital status</span>
                         <select required input type="text" class="form-control" name="cl_maritalStatus" required="active">
                           <option disabled selected hidden>Status</option>
                           <option value="Single">Single</option>
                           <option value="Married">Married</option>
                           <option value="Separated">Separated</option>
                           <option value="Divorced">Divorced</option>
                           <option value="Widowed">Widowed</option>
                         </select>
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">Middle Name</span>
                         <input type="text" class="form-control" required="active" name="cl_middleName" placeholder="Middle Name">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">Date of Birth</span>
                         <input type="date" class="form-control appointment_date" name="cl_birthdate" required="active" placeholder="">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">Last Name</span>
                         <input type="text" required="active" class="form-control" name="cl_lastName" placeholder="Last Name">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">Email</span>
                         <input type="text" class="form-control" required="active" name="user_email" placeholder="Email">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">Gender</span>
                         <select required input type="text" class="form-control" required="active" name="cl_gender" placeholder="Gender">
                           <option disabled selected hidden>Gender</option>
                           <option value="Male">Male</option>
                           <option value="Female">Female</option>
                           <option value="Others">Others</option>
                         </select>
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">House No.</span>
                         <input type="text" class="form-control" required="active" name="cl_houseNo" placeholder="#">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">Street</span>
                         <input type="text" class="form-control" required="active" name="cl_street" placeholder="Street">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">Barangay</span>
                         <input type="text" class="form-control" required="active" name="cl_brgy" placeholder="Brgy">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">City</span>
                         <input type="text" class="form-control" required="active" name="cl_city" placeholder="City">
                       </div>
                     </div>
                     <div class="col-md-6">
                       <div class="form-group">
                         <span class="o-label">Contact No.</span>
                         <input type="text" class="form-control" required="active" name="cl_contactNo" placeholder="Contact No.">
                       </div>
                     </div>
                   </div>
                 </div>
                 <div class="btns-group">
                   <a href="#" class="btn btn-prev">Previous</a>
                   <button type="submit" class="btn btn-outline-success">Register </a>
                 </div>
               </div>
               </form>
           </div>
         </div>
       </div>
     </div>
 </section>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
   <div class="modal-dialog modal-xl">
     <div class="modal-content">
       <div class="modal-header">
         <h5 class="modal-title" id="exampleModalLabel">Privacy Policy for Faith Hope Love</h5>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
         {% include 'clientside/privacy.html' %}
       </div>
       <div class="modal-footer">
         <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
         <button type="button" class="btn btn-success" data-bs-dismiss="modal">I Agree</button>
       </div>
     </div>
   </div>
 </div>

<script type="text/javascript">
   $(window).on('load', function() {
       $('#exampleModal').modal('show');
   });
</script>

<script>
const prevBtns = document.querySelectorAll(".btn-prev");
const nextBtns = document.querySelectorAll(".btn-next");
const progress = document.getElementById("progress");
const formSteps = document.querySelectorAll(".form-step");
const progressSteps = document.querySelectorAll(".progress-step");

let formStepsNum = 0;

nextBtns.forEach((btn) => {
	btn.addEventListener("click", () => {
		formStepsNum++;
		updateFormSteps();
		updateProgressbar();
	});
});

prevBtns.forEach((btn) => {
	btn.addEventListener("click", () => {
		formStepsNum--;
		updateFormSteps();
		updateProgressbar();
	});
});

function updateFormSteps() {
	formSteps.forEach((formStep) => {
		formStep.classList.contains("form-step-active") &&
			formStep.classList.remove("form-step-active");
	});

	formSteps[formStepsNum].classList.add("form-step-active");
}

function updateProgressbar() {
	progressSteps.forEach((progressStep, idx) => {
		if (idx < formStepsNum + 1) {
			progressStep.classList.add("progress-step-active");
		} else {
			progressStep.classList.remove("progress-step-active");
		}
	});

	const progressActive = document.querySelectorAll(".progress-step-active");

	progress.style.width =
		((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + "%";
}
 </script>
<script type="text/javascript">

  function alertFailure(msg){
    Swal.fire({
    icon: 'error',
    title: 'Registration Failed',
    text: msg
})
  }

  function alertLoginFailure(message) {
    $('#failedLogin').append(
        '<div class="alert alert-danger d-flex align-items-center" role="alert">' + 
          '<svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/>' + '</svg>' +
          '<div>' + message + '</div>' + '</div>'
    )
  }

  // setTimeout(function() {
  //       bootstrap.Alert.getOrCreateInstance(document.querySelector(".alert")).close();
  //   }, 3000)
  
  function sweetSuccess() {
    Swal.fire({
    icon: 'success',
    title: 'Successfully Registered',
    text: '',
    footer: 'Would you like to \t<b><a href="https://clinic-local.herokuapp.com/users">login?</a></b>',
    timer: 15000
  })
}  
  $("#registerForm").submit(function(e) {
      e.preventDefault();
      var frm = $("#registerForm");
      var data = {};
      $.each(this, function(i, v){
          var input = $(v);
          data[input.attr("name")] = input.val();
          delete data["undefined"];
      });
      $.ajax({
          contentType:"application/json; charset=utf-8",
          type:frm.attr("method"),
          url:frm.attr("action"),
          dataType:'text',
          data: JSON.stringify(data),
          success: function(data) {
          //  sweetSuccess('test')
          
           window.setTimeout(sweetSuccess(), 25000);
          
          },
          error: function(error) {
            resAlert = error.responseText.slice(11,-2),
            window.setTimeout(alertFailure(resAlert), 25000);
          }
      })
  });
     // function Login(){
  
     //    const promise = $.ajax({
     //     type: 'POST',
     //     url: 'https://fth-clinic.herokuapp.com/users/login',
     //     contentType: "application/json",
     //     dataType: "json",
     //     data: JSON.stringify( {"user_email": $("#user_email").val(), "user_password": $("#user_password").val()})
     //    })
     //    promise.then(function (data){
     //       console.log(data);
     //       window.open("appointments.html", "_self").reload(),
     //       alert("Login Successfully")
     //    })
     // }
  </script>
{% endblock %}